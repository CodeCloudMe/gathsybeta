/*!
 * datepair.js v0.2.3 - A javascript plugin for intelligently selecting date and time ranges inspired by Google Calendar.
 * Copyright (c) 2014 Jon Thornton - http://jonthornton.github.com/Datepair.js
 * License: MIT
 */

!function(a,b){"use strict";function c(a,b){var c=b||{};for(var d in a)d in c||(c[d]=a[d]);return c}function d(a,c){if(h)h(a).trigger(c);else{var d=b.createEvent("CustomEvent");d.initCustomEvent(c,!0,!0,{}),a.dispatchEvent(d)}}function e(a,b){return h?h(a).hasClass(b):a.classList.contains(b)}function f(a,b){if(this.dateDelta=null,this.timeDelta=null,this._defaults={startClass:"start",endClass:"end",timeClass:"time",dateClass:"date",defaultDateDelta:0,defaultTimeDelta:36e5,parseTime:function(a){return h(a).timepicker("getTime")},updateTime:function(a,b){h(a).timepicker("setTime",b)},setMinTime:function(a,b){h(a).timepicker("option","minTime",b)},parseDate:function(a){return h(a).datepicker("getDate")},updateDate:function(a,b){h(a).datepicker("update",b)}},this.container=a,this.settings=c(this._defaults,b),this.startDateInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.dateClass),this.endDateInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.dateClass),this.startTimeInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.timeClass),this.endTimeInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.timeClass),this.startDateInput&&this.startDateInput.value&&this.startDateInput&&this.endDateInput.value){var d=this.settings.parseDate(this.startDateInput),e=this.settings.parseDate(this.endDateInput);this.dateDelta=e.getTime()-d.getTime()}if(this.startTimeInput&&this.startTimeInput.value&&this.endTimeInput&&this.endTimeInput.value){var f=this.settings.parseTime(this.startTimeInput),g=this.settings.parseTime(this.endTimeInput);this.timeDelta=g.getTime()-f.getTime()}this._bindChangeHandler()}var g=864e5,h=a.Zepto||a.jQuery;f.prototype={constructor:f,option:function(a,b){if("object"==typeof a)this.settings=c(this.settings,a);else if("string"==typeof a&&"undefined"!=typeof b)this.settings[a]=b;else if("string"==typeof a)return this.settings[a]},getTimeDiff:function(){return this.dateDelta*g+this.timeDelta},remove:function(){this._unbindChangeHandler()},_bindChangeHandler:function(){h?h(this.container).on("change.datepair",h.proxy(this.handleEvent,this)):this.container.addEventListener("change",this,!1)},_unbindChangeHandler:function(){h?h(this.container).off("change.datepair"):this.container.removeEventListener("change",this,!1)},handleEvent:function(a){this._unbindChangeHandler(),e(a.target,this.settings.dateClass)?""!=a.target.value?this._dateChanged(a.target):this.dateDelta=null:e(a.target,this.settings.timeClass)&&(""!=a.target.value?this._timeChanged(a.target):this.timeDelta=null),this._validateRanges(),this._updateEndMintime(),this._bindChangeHandler()},_dateChanged:function(a){if(this.startDateInput&&this.endDateInput)if(this.startDateInput.value&&this.endDateInput.value){var b=this.settings.parseDate(this.startDateInput),c=this.settings.parseDate(this.endDateInput);if(e(a,this.settings.startClass)){var d=new Date(b.getTime()+this.dateDelta);this.settings.updateDate(this.endDateInput,d)}else e(a,this.settings.endClass)&&(b>c?(this.dateDelta=0,this.settings.updateDate(this.startDateInput,c)):this.dateDelta=c.getTime()-b.getTime())}else if(null!==this.settings.defaultDateDelta){if(this.startDateInput.value){var b=this.settings.parseDate(this.startDateInput),f=new Date(b.getTime()+this.settings.defaultDateDelta*g);this.settings.updateDate(this.endDateInput,f)}else if(this.endDateInput.value){var c=this.settings.parseDate($endDateInput),h=new Date(c.getTime()-this.settings.defaultDateDelta*g);this.settings.updateDate(this.startDateInput,h)}this.dateDelta=this.settings.defaultDateDelta*g}else this.dateDelta=null},_timeChanged:function(a){if(this.startTimeInput&&this.endTimeInput)if(this.startTimeInput.value&&this.endTimeInput.value){var b=this.settings.parseTime(this.startTimeInput),c=this.settings.parseTime(this.endTimeInput);if(e(a,this.settings.startClass)){var d=new Date(b.getTime()+this.timeDelta);this.settings.updateTime(this.endTimeInput,d),c=this.settings.parseTime(this.endTimeInput)}if(this.endDateInput&&this.endDateInput.value&&this.dateDelta+this.timeDelta<g&&(c.getTime()-b.getTime())*this.timeDelta<0){var f=b>c?g:-1*g,h=this.settings.parseDate(this.endDateInput);this.settings.updateDate(this.endDateInput,new Date(h.getTime()+f)),this._dateChanged(this.endDateInput)}this.timeDelta=c.getTime()-b.getTime()}else if(null!==this.settings.defaultTimeDelta){if(this.startTimeInput.value){var b=this.settings.parseTime(this.startTimeInput),i=new Date(b.getTime()+this.settings.defaultTimeDelta);this.settings.updateTime(this.endTimeInput,i)}else if(this.endTimeInput.value){var c=this.settings.parseTime(this.endTimeInput),j=new Date(c.getTime()-this.settings.defaultTimeDelta);this.settings.updateTime(this.startTimeInput,j)}this.timeDelta=this.settings.defaultTimeDelta}else this.timeDelta=null},_updateEndMintime:function(){if("function"==typeof this.settings.setMinTime){var a=null;(!this.dateDelta||this.dateDelta<g||this.timeDelta&&this.dateDelta+this.timeDelta<g)&&(a=this.settings.parseTime(this.startTimeInput)),this.settings.setMinTime(this.endTimeInput,a)}},_validateRanges:function(){return this.startTimeInput&&this.endTimeInput&&null===this.timeDelta?void d(this.container,"rangeIncomplete"):this.startDateInput&&this.endDateInput&&null===this.dateDelta?void d(this.container,"rangeIncomplete"):void(this.dateDelta+this.timeDelta>=0?d(this.container,"rangeSelected"):d(this.container,"rangeError"))}},a.Datepair=f}(window,document);